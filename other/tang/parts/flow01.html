<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <title>test</title>
    <style type="text/css">
        *{ margin:0; padding:0;}
        body{font:12px/2 arial; background:#3f3f3f;}
        .wrap{ width:1000px; margin:0 auto;}
        .loading{ position:absolute; width:100%; padding:10px 0; text-align:center; background:#f3f3f3;}
        .list{ float:left; width:250px;}
        .item{ margin:5px 5px 10px; background:#fff; padding:5px;text-align:center; border-radius:5px; box-shadow:0 2px 3px #000;}
        .item img{ margin:5px; border-radius:5px;box-shadow:0 2px 3px #ccc;}
        .top{ position:fixed; right:100px; bottom:100px; cursor:pointer;}
    </style>
</head>
<body>
<h4>I like scroll</h4>
<div id="wrap" class="wrap">
    <div id="one" class="list"></div>
    <div id="two" class="list"></div>
    <div id="three" class="list"></div>
    <div id="four" class="list"></div>
</div>
<div class="loading" id="loading"><img src="http://ctc.qzonestyle.gtimg.cn/photo-v2/img/loading.gif" alt=""></div>
<div class="top" id="top"><img src="http://img02.taobaocdn.com/tps/i2/T1wMtNXkhvXXXXXXXX.png" alt=""></div>
<script type="text/javascript">
    function Flow(settings){
        for (var p in settings) {
            this[p] = settings[p];
        }
    }
    var imgHeight  = 0, // 图片的高度
        k          = 0, // 计数器
        textHeight = 0;
    Flow.prototype = {
        // 获得元素
        id: function(){
            return document.getElementById(arguments[0]);
        },
        init: function(){
            window.onscroll = this.scrollLoad.call(this);
            this.loadImg();
        },
        // 浏览器
        browserType: function(){
            var ua = navigator.userAgent.toLowerCase();
            return {
                isIE      : /msie/.test(ua),
                isFirefox : /gecko/.test(ua)
            };
        }(),
        scrollLoad: function(){
            var that       = this,
                viewAll    = that.browserType.isFirefox ? document.documentElement.scrollHeight : document.body.scrollHeight,
                scroll     = document.body.scrollTop || document.documentElement.scrollTop,
                view       = 500,
                end        = viewAll - scroll;
            this.viewAll = viewAll;

            if(end < view){
                 setTimeout(function(){
                     that.loadImg();
                 }, 1000);
            }
        },
        loadImg: function(){
            var that = this,
                load = that.id('loading');
            load.style.display = 'none';
            that.textArr = ['小花美女', '小花美女','小花美女','小花美女','小花美女','小花美女','小花美女','小花美女','小花美女','小花美女','小花美女','小花美女','小花美女','小花美女','小花美女'];
            that.imgArr = [];
            that.imgArr[0] = ['http://ww4.sinaimg.cn/mw205/960bda11tw1dnw504ga3vj.jpg'];
            that.imgArr[1] = ['http://ww1.sinaimg.cn/mw205/771f735ctw1dnw5gv6dmcj.jpg'];
            that.imgArr[2] = ['http://ww3.sinaimg.cn/mw205/5d5e9605gw1dnw4o6uk3gj.jpg'];
            that.imgArr[3] = ['http://ww4.sinaimg.cn/mw205/960bda11tw1dnw504ga3vj.jpg'];
            that.imgArr[4] = ['http://ww1.sinaimg.cn/mw205/6d9cb0b8jw1dnw5m0y5yrj.jpg'];
            that.imgArr[5] = ['http://ww2.sinaimg.cn/mw205/62dae985gw1dnzc4mwvm5j.jpg'];
            that.imgArr[6] = ['http://ww2.sinaimg.cn/mw205/8d95fb4cgw1dnzec2c6cdj.jpg'];
            that.imgArr[7] = ['http://ww4.sinaimg.cn/mw205/872bccc8jw1dnzch2aqtkj.jpg'];
            that.imgArr[8] = ['http://ww4.sinaimg.cn/mw205/5b104465tw1dnzdlozp6tj.jpg'];
            that.imgArr[9] = ['http://ww4.sinaimg.cn/mw205/960bda11tw1dnw504ga3vj.jpg'];
            that.imgArr[10] = ['http://ww4.sinaimg.cn/mw205/6de170f6jw1dnzl7jbzidj.jpg'];
            that.imgArr[11] = ['http://ww2.sinaimg.cn/mw205/6a93dbfbgw1dnzeiu1draj.jpg'];
            that.imgArr[12] = ['http://ww3.sinaimg.cn/mw205/6ea59a74jw1dnzm0wbf7vj.jpg'];
            that.imgArr[13] = ['http://ww4.sinaimg.cn/mw205/5b104465tw1dnzdlozp6tj.jpg'];
            that.imgArr[14] = ['http://ww2.sinaimg.cn/mw205/48bf076ejw1dnzexjhl6dj.jpg'];
            that.imgArr[15] = ['http://ww4.sinaimg.cn/mw205/6da7993fjw1dnvsnesrutj.jpg'];
            var imgLen = that.imgArr.length,
                numArray = that.numArr = [0, 0, 0, 0],
                length = 4,
                i      = 0,
                div1   = that.id('one'),
                div2   = that.id('two'),
                div3   = that.id('three'),
                div4   = that.id('four'),
                wrap   = that.id('wrap');

            k++;
            for(i = 0; i < length; i++){
                div1.appendChild(that.addNode());
                div2.appendChild(that.addNode());
                div3.appendChild(that.addNode());
                div4.appendChild(that.addNode());
            }
            setTimeout(function(){
                var oImg = document.getElementsByTagName('img');
                imgLen = imgLen * k;     // 图片的总和
                console.log(imgLen);
                var j = imgLen / length; // 每列上分布的图片
                for(var i = 0; i < imgLen; i++){
                    switch(i){
                        case (i < j):
                            numArray[0] += imgHeight + 10 + textHeight;
                        case (i >= 2 * j && i < 3 * j):
                            numArray[1] += imgHeight + 10 + textHeight;
                        case (i >= 3 * j && i < 4 * j):
                            numArray[2] += imgHeight + 10 + textHeight;
                        case (i >= 4 * j):
                            numArray[3] += imgHeight + 10 + textHeight;
                    }
                }
                numArray.sort();
                wrap.style.height = numArray[0] + 'px';
                var h = that.browserType.isFirefox ? document.documentElement.scrollHeight : document.body.scrollHeight;
                load.style.top = h + 'px';
                load.style.display = 'block';
            }, 1000);
        },
        // 添加 div
        addNode: function(){
            var index   = Math.round(Math.random() * (this.imgArr.length - 1)),
                imgInfo = document.createElement('p'),
                img     = document.createElement('img'),
                wrap    = document.createElement('div');
            
            imgInfo.innerHTML = this.textArr[index];
            img.alt           = '';
            img.src           = this.imgArr[index];
            
            wrap.className = 'item';
            wrap.appendChild(img);
            wrap.appendChild(imgInfo);
            return wrap;
        }
    }
    var fa = new Flow();
    fa.init();
</script>

</body>
</html>