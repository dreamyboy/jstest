<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head>	<title></title>	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />	<style type="text/css">		.wrap{width:400px;}		#pText{width:250px;border:1px solid #ccc;background:#ccc;}	</style></head><body>	<span style="width:100px;height:18px;display:inline-block;overflow:hidden;">我是一个换那，别林斯基或要不是苗子，别林斯基或要不是苗子</span>	<input type="text" name="" id="" />	<input type="text" name="" id="" />	<h1 tag='false'>Introduction to the DOM</h1>	<div class="wrap">		<p id="pText" class="test">There are a number of resons why DOM is anywhere,here are some:</p>	</div>	<ul id="ul">		<li>It can be found everywhere</li>		<li id="everywhere" class="test">It's easy to user.</li>		<li class="test">It's can help you to find what you want.</li>		<li class="test">It's can help you to find what you want.</li>	</ul>	<a href="http://jikey.cnblogs.com" id="jikey">jikey</a>	<script type="text/javascript">/*var li = document.getElementsByTagName('li');for(var j=0; j<li.length; j++){	li[j].onmouseover = function(){		this.style.border = '10px solid blue';	}	li[j].onmouseout = function(){		this.style.border = '10px solid green';	}}function fac(n){	var result = 1, i=1;	do{		result = result * i;		i = i + 1;	} while( i<=n);	return result;}var every = document.getElementById('everywhere');every.parentNode.removeChild(every);var items = [1, 2, 3];var itemRef = items;items.push('four');alert(itemRef.length);var item = 'test';var itemRef = item;item += 'ing';//alert(item == itemRef); //false;function sendMessage(msg, obj){	if(arguments.length == 2){		obj.handleMsg(msg);	} else {		alert(msg);	}}sendMessage('how are you');sendMessage('and you', {	handleMsg: function(msg){		alert('This is a custom message: ' + msg);	}});function strict(types, args){	if(types.length != args.length){		throw 'Invalid number of argument. Expected ' + types.length + ', received ' + args.length;	}		for(var i=0; i<args.length; i++){		if(args[i].constructor != type[i]){			throw 'Invalid argument type. Expected' + types[i].name;		}	}}var obj = {	yes: function(){		this.val = true;	},	no: function(){		this.val = false;	}}alert(obj.val == null);obj.yes();alert(obj.val == true);*/var every = document.getElementById('everywhere');var ul = document.getElementById('ul');function $(){ return document.getElementById(arguments[0])};/** * 得到上一个元素 * @param {Object} elem */function prev(elem){	do{		elem = elem.previousSibling;	} while(elem && elem.nodeType != 1);	return elem;}/** * 得到下一个元素 * @param {Object} elem */function next(elem){	do{		elem = elem.nextSibling;	} while(elem && elem.nodeType != 1);	return elem;}/** * 得到第一个元素 * @param {Object} elem */function first(elem){	elem = elem.firstChild;	return elem && elem.nodeType != 1 ? next(elem) : elem;}/** * 得到最后一个元素 * @param {Object} elem */function last(elem){	elem = elem.lastChild;	return elem && elem.nodeType != 1 ? prev(elem) : elem;}/** * 得到父元素 * @param {Object} elem * @param {Number} num 需要寻找的父级级别 */function parent(elem, num){	num = num || 1;	for(var i=0; i<num; i++){		if(elem != null) elem = elem.parentNode; //原书中这块有错	}	return elem;}/** * 得到相关name元素 * @param {String} name * @param {Object} elem */function tag(name, elem){	return (elem || document).getElementsByTagName(name)}/** * 根据tag寻找 * @param {String} name * @param {String} type */function hasClass(name, type){	var r = [];	var re = new RegExp('(^|\\s)'+name+'(\\s|$)');	var e = document.getElementsByTagName(type || '*');	for(var i=0; i<e.length; i++){		if(re.test(e[i].className)){			r.push(e[i]);		}	}	return r;	//http://www.cnblogs.com/rubylouvre/archive/2009/09/01/1557765.html //司徒有不同的看法}	//http://www.cnblogs.com/rubylouvre/archive/2009/09/01/1557765.html//alert(hasClass('test')[0].innerHTML);function addEvent( obj, type, fn ) {	if ( obj.attachEvent ) {		obj['e'+type+fn] = fn;		obj[type+fn] = function(){obj['e'+type+fn]( window.event );}		obj.attachEvent( 'on'+type, obj[type+fn] );	} else		obj.addEventListener( type, fn, false );}function removeEvent( obj, type, fn ) {	if ( obj.detachEvent ) {		obj.detachEvent( 'on'+type, obj[type+fn] );		obj[type+fn] = null;	} else	obj.removeEventListener( type, fn, false );}/** * 获取元素文本 * @param {Object} e */function text(e){	var t = '';	e = e.childNodes || e;	for(var i=0; i<e.length; i++){		//如果不是元素，则追加其文本值		t += e[i].nodeType != 1 ? e[i].nodeValue : text(e[i].childNodes);	}	return t;}//alert(text(document.getElementById('everywhere')));/** *  * @param {String} elem * @param {String} name * @param {String} value */function attr(elem, name, value){	if(!name || name.constructor != String){		return '';	}		//检查name的属性是否在怪异命名情形中	name = {'for': 'htmlFor', 'class': 'className'}[name] || name;		if(typeof value != 'undefined'){		elem[name] = value;				if(elem.setAttribute){			elem.setAttribute(name, value);		}	}		return elem[name] || elem.getAttribute(name) || '';}//alert(attr(tag('h1')[0], 'tag1', 'true'));//alert()/*var input = tag('input');for(var i=0; i<input.length; i++){	attr(input[i], 'name', 'jikey');		if(attr(input[i], 'name') == 'jikey'){		input[i].style.border = '2px solid red';	}}*//** * 在另一个元素之前插件元素 * @param {Object} parent * @param {Object} before * @param {String} elem */function before(parent, before, elem){	if(elem == null){		elem = before;		before = parent;		parent = before.parentNode;	}		//获取元素的新数组	var elems = checkElem(elem);		//向后遍历	for(var i=elems.length; i>=0; i--){		parent.insertBefore(elems[i], before);	}}/** * 创建元素 * @param {Object} elem */function create(elem){	//测试是否用命名空间来创建新的元素	return document.createElementNS ? document.createElementNS('http://www.w3.org/1999/xhtml', elem) : document.createElement(elem);}/** * before 辅助函数 * @param {Object} elem */function checkElem(a){	var r = [];	if(a.constructor != Array){ a = [a]};	for(var i=0; i<a.length; i++){		//如果是字符串		if(a[i].constructor == String){			//用一个临时元素来存放HTML			var div = document.createElement('div');			div.innerHTML = a[i];			//提取DOM结构到临时的div中			for(var j=0; j<div.childNodes.length; j++){				r[r.length] = div.childNodes[j];			}		} else if(a[i].length){ //如果它是数组			//假定DOM节点数组			for(var j=0; j<a[i].length; j++){				r[r.length] = a[i][j];			}		} else { //否则假定是DOM节点			r[r.length] = a[i];		}	}		return r;}//此方法我已修改与原文中有异/** * 添加元素 (如果只有一个参数(无elem)，则直接添加到document.body上) * @param {Object} elem  * @param {Object} parent */function append(parent, elem){	if(elem == null){		elem = parent;		parent = null;	}		//获取元素数组	var elems = checkElem(elem);	for(var i=0; i< elems.length; i++){		(parent || document.body).appendChild(elems[i]);	}}/** * 删除独立的DOM * @param {Object} elem */function remove(elem){	if(elem){ elem.parentNode.removeChild(elem) };}/** * 删除一个节点的所有子节点 * @param {Object} elem */function empty(elem){	while(elem.firstChild){		remove(elem.firstChild);	}}/** * 阻止事件冒泡 * @param {Object} e */function stopBubble(e){	if(e && e.stopPropagation){		e.stopPropagation();	} else {		window.event.cancelBubble = true;	}}function stopDefault(e){	if(e && e.preventDefault){		e.preventDefault();	} else {		window.event.returnValue = false;	}	return false;}/*var div = create('div');div.className = 'items';div.id = 'all';div.innerHTML = '我是一个兵也';append(tag('h1')[0], '<li>我是一个兵也</li>');//before(document, tag('h1')[0], '我是一个兵');empty(last(tag('ul')[0]));var all = tag('*');for(var i=0, len=all.length; i<len; i++){	all[i].onmouseover = function(e){		this.style.border = '1px solid #ccc';		stopBubble(e);	}		all[i].onmouseout = function(e){		this.style.border = '1px solid #fff';		stopBubble(e);	}}var a = $('jikey');a.onclick = function(e){	stopDefault(e);}*//** * 得到外链样式 * @param {Object} elem * @param {String} name */function getStyle(elem, name){	if(elem.style[name]){		return elem.style[name];	} else if(elem.currentStyle){ //如果ie		return elem.currentStyle[name];	} else if(document.defaultView && document.defaultView.getComputedStyle){ //如果是不是w3c方法		name = name.replace(/([A-Z])/g, '-$1');		name = name.toLowerCase();				//获取样式		var s = document.defaultView.getComputedStyle(elem, '');		return s && s.getPropertyValue(name);	} else {		return null;	}}/** * 获取元素的x位置 * @param {String} elem */function pageX(elem){	return elem.offsetParent ? elem.offsetLeft + pageX(elem.offsetParent) : elem.offsetLeft;}/** * 获取元素的Y位置 * @param {String} elem */function pageY(elem){	return elem.offsetParent ? elem.offsetTop + pageY(elem.offsetParent) : elem.offsetTop;}/** * 获取元素相对于父级的x位置 * @param {String} elem */function parentX(elem){	return elem.parentNode == elem.offsetParent ? elem.offsetLeft : pageX(elem) - pageX(elem.parentNode);}/** * 获取元素相对于父级的Y位置 * @param {String} elem */function parentY(elem){	return elem.parentNode == elem.offsetParent ? elem.offsetTop : pageY(elem) - pageY(elem.parentNode);}/** * 查找元素的左端位置 * @param {Object} elem */function posX(elem){	return parseInt(getStyle(elem, 'left'));}/** * 查找元素的顶端位置 * @param {Object} elem */function posY(elem){	return parseInt(getStyle(elem, 'top'));}/** * 设置元素水平位置 * @param {Object} elem * @param {Object} pos */function setX(elem, pos){	elem.style.left = pos + 'px';}/** * 设置垂直水平位置 * @param {Object} elem * @param {Object} pos */function setY(elem, pos){	elem.style.top = pos + 'px';}/** * 获取高度 * @param {Object} elem */function getHeight(elem){	return parseInt(getStyle(elem, 'height'));}/** * 获取宽度 * @param {Object} elem */function getWidth(elem){	return parseInt(getStyle(elem, 'width'));}/** * 得到完整的高度，就算对象已隐藏 * @param {Object} elem */function fullHeight(elem){	//如果元素显示	if(getStyle(elem, 'display') != 'none'){		return elem.offsetHeight || getHeight(elem);	}		//如果不显示，则复原css	var old = resetCss(ele, {		display: '',		visibility: 'hidden',		position: 'absolute'	});		var h = elem.clientHeight || getHeight(elem);	restoreCss(elem, old);		return h;}/** * 恢复原有设置 * @param {String} elem * @param {Object} prop */function resetCss(elem, prop){	var old = {};		for(var i in prop){		old[i] = prop[i];		elem.style[i] = prop[i];	}	return old;}/** *  * @param {String} elem * @param {Object} old */function restoreCss(elem, old){	for(var i in old){		elem.style[i] = old[i];	}}/** * 隐藏元素 * @param {String} elem */function hide(elem){	var curDisplay = getStyle(elem, 'display');		if(curDisplay != 'none'){		elem.oldDisplay = curDisplay;	}	elem.style.display = 'none';}/** * 显示元素 * @param {String} elem */function show(elem){	elem.style.display = elem.oldDisply || 'block';}/** * 设置透明度 * @param {Object} elem * @param {Object} level (0-100) */function setOpacity(elem, level){	if(elem.filters){ //如果是IE		elem.style.filter = 'alpha(opacity=' + level + ')';		//必须设置zoom,要不然透明度在IE下不生效  From:http://blog.csdn.net/dxx1988/article/details/6581430		elem.style.zoom = 1;	} else { //否则是W3C		elem.style.opacity = level / 100;	}}/** * 滑动 * @param {Object} elem */function slideDown(elem){	//elem.style.height = '0px';		show(elem);	var h = fullHeight(elem);		for(var i=0; i<=100; i+=5){		(function(){			var pos = i;						setTimeout(function(){				elem.style.height = (pos/100) * h + 'px';			}, (pos + 1) * 5);		})();	}}//slideDown($('pText'));//alert(fullHeight($('pText')));/** * 透明度渐显 From: http://mrthink.net/js-fadein-fadeout-fadeto/ * @param {Object} elem * @param {Number} speed 淡入速度,正整数(可选) * @param {Number} opacity 淡入到指定的透明度,0~100(可选) */function fadeInThink(elem, speed, opacity){	speed = speed || 20;	opacity = opacity || 100;		show(elem);	setOpacity(elem, 0);	//初始化透明度变化值为0	var val = 0;	//循环将透明值以5递增,即淡入效果	(function(){		setOpacity(elem, val);		val += 5;		if (val <= opacity) {			setTimeout(arguments.callee, speed)		}	})();}/** * 透明度渐显 * @param {Object} elem */function fadeIn(elem){	//setOpacity(emel, 0);		show(elem);	for(var i=0; i<=100; i+=10){		(function(){			var pos = i;			setTimeout(function(){				setOpacity(elem, pos);			}, (pos + 1) * 10);		})();	}}/** * 透明度渐隐 From: http://mrthink.net/js-fadein-fadeout-fadeto/ * @param {Object} elem */function fadeOut(elem){	var val = 100;		(function(){		setOpacity(elem, val);		val -= 5;		if(val >= 0){			setTimeout(arguments.callee, 50);		} else if(val < 0){			hide(elem);		}	})();}//fadeInThink($('pText'));/*** 光标的水平位置* @param {Object} e*/function getX(e){	e = e || window.event;		return e.pageX || e.clientX + document.body.scrollLeft;}/*** 光标的垂直位置* @param {Object} e*/function getY(e){	e = e || window.event;		return e.pageY || e.clientY + document.body.scrollTop;}/** * 获得鼠标相对于当前元素的X位置 * @param {Object} e */function getElementX(e){	return (e && e.layerX) || window.event.offsetX;}/** * 获得鼠标相对于当前元素的Y位置 * @param {Object} e */function getElementY(e){	return (e && e.layerY) || window.event.offsetY;}/** * 当前页面的高度 */function pageHeight(){	return document.body.scrollHeight;}/** * 当前页面的宽度 */function pageWidth(){	return document.body.scrollWidth;}//alert(pageHeight());/** * 视口的高度 */function windowHeight(){	var de = document.documentElement;		return self.innerHeight || (de && de.clientHeight) || document.body.clientHeight;}/** * 视口的高度 */function windowWidth(){	var de = document.documentElement;		return self.innerWidth || (de && de.clientWidth) || document.body.clientWidth;}/** * 浏览器水平滚动位置 */function scrollX(){	var de = document.documentElement;		return self.pageOffsetset ||  (de && de.scrollLeft) || document.body.scrollLeft;}/*** 浏览器垂直滚动位置 */function scrollY(){	var de = document.documentElement;		return self.pageYOffset || (de && de.scrollTop) || document.body.scrollTop;}/** * 串行化一系列数据，支持两种不同的对象 * - 表单输入元素的数组 * - 键/值对的散列值 * @return 串行化后的字符串 * @param {Object} a */function serialize(a){	var s = [];		//如果是数组，假定为表单元素的数组	if(a.constructor == Array){		for(var i=0; i<a.length; i++){			s.push(a[i].name + '=' + encodeURIComponent(a[i].value)); //把字符串编码为 URI 组件(十六进制转义替换) decodeURIComponent()解码		}	} else {		for(var i in a){			s.push(j + '=' + encodeURIComponent(a[j]));		}	}}/** * From: 另外一个版本的ajax封装 - http://blog.csdn.net/dxx1988/article/details/6620662 * ajax通用函数 * @param {Object} options */function ajax(options){	options = {		type       :  options.type || 'POST',              //HTTP请求的类型		url        :  options.url || '',                   //请求的URL		timeout    :  options.timeout || 5000,             //请求超时时间		onComplete :  options.onComplete || function(){},  //完成后调用的函数		onError    :  options.onError || function(){},     //错误时调用的函数		onSuccess  :  options.onSuccess || function(){},   //成功后调用的函数		date       :  options.date || ''                   //服务器返回的数据类型	}		var xml = new XMLHttpRequest(); //创建请求对象	xml.open(options.type, options.url, true); //初始化请求对象		var timeoutLength = options.timeout; //请求后等待5秒，超时则放弃	var requestDone = false; //记录请求是否成功完成		//初始化一个5秒后执行的回调函数，用于取消请求	setTimeout(function(){		requestDone = true;	}, timeoutLength);		//监听状态	xml.onreadystatechange = function(){		if(xml.readystate == 4 && !requestDone){			if(httpSuccess(xml)){ //检查是否请求成功				//以服务返回的数据作为参数调用成功后回调函数				options.onSuccess(httpData(xml), options.type);			} else {				options.onError();			}			options.onComplete();						//为避免内存泄漏，清理文档			xml = null;		}	};		//建立与服务器连接	xml.send();		//判断http是否响应成功	function httpSuccess(r){		try{			//如果得不到服务器状态，被认为正在请求本地文件			return !r.status && location.protocol == 'file:' ||						//200到300的状态码算成功 			(r.status >= 200 && r.status < 300) ||						//文档未修改也算成功			r.status == 304 ||						//safari在文档未修改时返回空			navigator.userAgent.indexOf('Safari') >= 0 && typeof r.status == 'undefined';		} catch(e){ //请求失败			return false;		}	}		//从http响应中解析正确数据	function httpData(r, type){		//获取content-type的首部		var cy = r.getResponseHeader('content-type');				//若没有提供默认类型，判断返回的类型是否是xml		var data = !type && ct && ct.indexOf('xml') >= 0;				//如果是xml，则返回，否则返回text		data = type == 'xml' || data ? r.responseXML : r.responseText;				//若指定类型是'script', 则以js形式执行返回文本		if(type == 'script'){			eval.call(window, data);		}				return data;	}	}/** * 判断DOM是否加载完毕函数 * @param {Function} f */function domReady(f){	//如果DOM已经加载，马上执行函数	if(domReady.done) return f();		//如果增加了一个函数	if(domReady.timer){		//添加到待致行清单中		domReady.ready.push(f);	} else {		addEvent(window, 'load', isDOMReady);				//初始化待执行的函数		domReady.ready = [f];	}		//尽可能快的检查DOM是否已可用	domReady.timer = setInterval(isDOMReady, 13);}//检查DOM是否已可操作function isDOMReady(){	//如果把我们能判断出DOM已可用，忽略	if(domReady.done) return false;		//检查若干函数和元素是否可用	if(document && document.getElementsByTagName && document.getElementById && document.body){		//如果可用，我们可以停止检查		clearInterval(domReady.timer);		domReady.timer = null;				//执行所有正等待的函数		for(var i=0; i<domReady.ready.length; i++){			domReady.ready[i]();		}				domReady.ready = null;		domReady.done = true;	}}domReady(function(){	alert('the dom is loaded');	tag('h1')[0].style.border = '4px solid #ccc';});window.onload = function(){	tag('h1')[0].innerHTML = '我是h1';}</script><h1>Testing DOM loading</h1></body></html>