<!DOCTYPE html>
<html>
<head>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <meta charset=utf-8 />
    <style type="text/css">
        li div { display: none;}
    </style>
    <title>JS Bin</title>
</head>
<body>
<form action="" method="" name="" class="u_form" id="">
    <div id="tree">
        <ul>
            <li>
                <p><input type="checkbox" name="" class="u_checkbox" /><label for="">高二(1)班</label></p>
                <div>
                    <ul>
                        <li>
                            <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生</label></p>
                            <div>
                                <ul>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                </ul>

                            </div>
                        </li>
                        <li>
                            <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师</label></p>
                            <div>
                                <ul>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长</label></p>
                            <div>
                                <ul>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </li>
            <li>
                <p><input type="checkbox" name="" class="u_checkbox" /><label for="">高二(2)班</label></p>
                <div>
                    <ul>
                        <li>
                            <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生</label></p>
                            <div>
                                <ul>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                </ul>

                            </div>
                        </li>
                        <li>
                            <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师</label></p>
                            <div>
                                <ul>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长</label></p>
                            <div>
                                <ul>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </li>
            <li>
                <p><input type="checkbox" name="" class="u_checkbox" /><label for="">高二(3)班</label></p>
                <div>
                    <ul>
                        <li>
                            <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生</label></p>
                            <div>
                                <ul>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">学生名</label></p>
                                    </li>
                                </ul>

                            </div>
                        </li>
                        <li>
                            <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师</label></p>
                            <div>
                                <ul>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">老师名</label></p>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长</label></p>
                            <div>
                                <ul>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                    <li>
                                        <p><input type="checkbox" name="" class="u_checkbox" /><label for="">家长名</label></p>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
    </div>
</form>
<script type="text/javascript">
    $.fn.Tree = function (opts) {
        var set = $.extend({
            iParFn  : iParFn,
            iSilFn  : iSilFn,
            iChiFn  : iChiFn,
            lNexFn  : lNexFn,
            callback: function () {
            }
        });

        var _this = $(this);
        _this.click(function (event) {
            var T = event.target, node = T.nodeName.toLowerCase();
            if (node === 'label') {
                expand($(T));
            }
            if (node === 'input') {
                chose($(T));
            }
        });

        function chose(obj) {
            var $c = set.iChiFn(obj);
            $c.prop('checked', obj[0].checked);
            setParent.call(obj);
        };

        function setParent() {
            var $s = set.iSilFn(this), $p = set.iParFn(this);
            if ($p.length) {
                console.log($s);
                $p.prop('checked', this.add($s).not(':checked').length === 0);
                setParent.call($p);
            }
            ;
        };

        function expand(obj) {
            var $n = set.lNexFn(obj);
            $n.toggle();
        };

        function iParFn(obj) {
            return obj.closest('div').prev().find('input[type="checkbox"]');
        };
        function iSilFn(obj) {
            return obj.closest('li').siblings().find('>p>input[type="checkbox"]');
        };
        function iChiFn(obj) {
            return obj.closest('p').next().find('input[type="checkbox"]');
        };
        function lNexFn(obj) {
            return  obj.closest('p').next();
        };
    };

    $('#tree').Tree();
</script>
</body>
</html>